<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <form id='signInForm'>
        <div class="row">
            <label>邮箱</label>
            <input type="text" name='email'>
            <span class="error"></span>
        </div>
        <div class="row">
            <label>密码</label>
            <input type="password" name='password'>
            <span class="error"></span>
        </div>

        <input type="submit" value='登录'>
    </form>



    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
    <script>
        let $form = $('#signInForm')
        $form.on('submit', (e) => {
            e.preventDefault()
            let hash = {}
            let need = ['email', 'password']
            need.forEach((name) => {

                let value = $form.find(`[name=${name}]`).val()

                hash[name] = value
            })

            $form.find('.error').each((index, span) => {
                $(span).text('')
            })

            if (hash['email'] === '') {
                $form.find('[name="email"]').siblings('.error')
                    .text('请输入邮箱啊')
                return
            }
            if (hash['password'] === '') {
                $form.find('[name="password"]').siblings('.error')
                    .text('甜蜜妈呀')
                return
            }

            console.log(hash)
            $.post('/sign_in', hash)
                .then((response) => {
                    let object = JSON.parse(response)
                    localStorage.setItem("sessionId", object.sessionId)
                    localStorage.setItem("sessionId", "object.sessionId")
                    localStorage.setItem("sessionId", JSON.stringify(object.sessionId))
                    alert('sdfsdf')

                    window.location.href = `/?sessionId=${object.sessionId}`
                }, (request) => {
                    console.log('邮箱密码不匹配')
                })
        })
    </script>
</body>

</html>